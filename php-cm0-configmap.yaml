apiVersion: v1
data:
  Carta.php: |
    <?php
    header('Access-Control-Allow-Origin: http://localhost:3000');


    include "core.php";

    $conn = connectDatabase();

    $input = file_get_contents('php://input');
    if (!$input) {
        die(json_encode(['error' => "Nessun input ricevuto."]));
    }

    $data = [];
    parse_str($input, $data);

    $carta_email = isset($data['email']) ? filter_var($data['email'], FILTER_SANITIZE_FULL_SPECIAL_CHARS) : null;
    $carta_cardNumber = isset($data['numero']) ? filter_var($data['numero'], FILTER_SANITIZE_FULL_SPECIAL_CHARS) : null;
    $carta_expiryDate = isset($data['scadenza']) ? filter_var($data['scadenza'], FILTER_SANITIZE_FULL_SPECIAL_CHARS) : null;
    $carta_cardHolder = isset($data['titolare']) ? filter_var($data['titolare'], FILTER_SANITIZE_FULL_SPECIAL_CHARS) : null;
    $carta_city = isset($data['citta']) ? filter_var($data['citta'], FILTER_SANITIZE_FULL_SPECIAL_CHARS) : null;
    $carta_postalCode = isset($data['cap']) ? filter_var($data['cap'], FILTER_SANITIZE_FULL_SPECIAL_CHARS) : null;
    $carta_address = isset($data['indirizzo']) ? filter_var($data['indirizzo'], FILTER_SANITIZE_FULL_SPECIAL_CHARS) : null;
    $carta_country = isset($data['nazionalita']) ? filter_var($data['nazionalita'], FILTER_SANITIZE_FULL_SPECIAL_CHARS) : null;
    $carta_cvv = isset($data['cvv']) ? filter_var($data['cvv'], FILTER_SANITIZE_SPECIAL_CHARS) : null;

    if (!$carta_email || !$carta_cardNumber || !$carta_expiryDate || !$carta_cardHolder || !$carta_city || !$carta_postalCode || !$carta_address || !$carta_country || !$carta_cvv) {
        die(json_encode(['error' => "Tutti i campi sono obbligatori."]));
    }

    $email_check_stmt = $conn->prepare("SELECT email FROM t_utente WHERE email = ?");
    if (!$email_check_stmt) {
        die(json_encode(['error' => "Prepare failed: " . $conn->error]));
    }
    $email_check_stmt->bind_param("s", $carta_email);
    $email_check_stmt->execute();
    $email_check_stmt->store_result();

    if ($email_check_stmt->num_rows == 0) {
        $email_check_stmt->close();
        echo json_encode(['error' => "L'email non esiste nella tabella utenti!"]);
    } else {
        $email_check_stmt->close();

        $chck_stmt = $conn->prepare("SELECT * FROM t_carta_di_pagamento WHERE numero = ? AND email = ?");
        if (!$chck_stmt) {
            die(json_encode(['error' => "Prepare failed: " . $conn->error]));
        }
        $chck_stmt->bind_param("ss", $carta_cardNumber, $carta_email);
        $chck_stmt->execute();
        $chck_stmt->store_result();

        if ($chck_stmt->num_rows == 0) {
            $chck_stmt->close();

            $query = "INSERT INTO t_carta_di_pagamento (titolare, numero, scadenza, cvc, citta, cap, indirizzo, nazione, email) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)";
            $stmt = $conn->prepare($query);
            if (!$stmt) {
                die(json_encode(['error' => "Prepare failed: " . $conn->error]));
            }
            $stmt->bind_param("sssssssss", $carta_cardHolder, $carta_cardNumber, $carta_expiryDate, $carta_cvv, $carta_city, $carta_postalCode, $carta_address, $carta_country, $carta_email);

            if ($stmt->execute()) {
                echo json_encode(['success' => "Pagamento effettuato con successo."]);
            } else {
                echo json_encode(['error' => "Errore durante l'inserimento dei dati: " . $stmt->error]);
            }
            $stmt->close();
        } else {
            $chck_stmt->close();
            echo json_encode(['error' => "La carta esiste giÃ !"]);
        }
    }

    $conn->close();
    ?>
  Dockerfile: |-
    FROM php:7.1-apache
    RUN docker-php-ext-install mysqli
  Riempimento_Magazzino.php: "<?php\n\ninclude_once 'C:\\Users\\PC-A59\\Documents\\GitHub\\ecommerce-project\\src\\Database\\Funzioni\\Connection.php';\n//Connessione\nmysqli_select_db($conn, $database);\n\n// Controllo della connessione \nif (!$conn) {\n    die(\"Connection failed: \" . mysqli_connect_error());\n}\necho \"Connected successfully\";\n\n/* per poter inserire un nuovo prodotto bisogna avere la categoria\n\n    //inserimento della categoria\n    $sql = \" INSERT INTO t_categoria (id_categoria, tipo_categoria) VALUES ();\";\n    \n    \n    //controllo dell'insermineto della categoria  \n    if (mysqli_query($conn, $sql)) {\n        echo \"pantalone inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n\n*/\n\n// Loop per inserire 10 magliette \nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('1234', 'maglietta', '12', 'giovannibuonasera', '1224', 'rosso', 's');\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"Maglietta inserita correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n// Loop per inserire 10 pantaloni \nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('1235', 'pantalone', '12', 'giovannibuonasera', '1225', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"pantalone inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n// Loop per inserire 10 felpe\nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('0001', 'felpa', '12', 'giovannibuonasera', '0001', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"felpa inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n// Loop per inserire 10 gonne e vestiti\nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('0002', 'gonne e vestiti', '12', 'giovannibuonasera', '0002', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"gonne e vestiti inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n\n// Loop per inserire 10 pantaloncini\nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('0003', 'pantaloncini', '12', 'giovannibuonasera', '0003', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"pantaloncino inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n\n// Loop per inserire 10 giacche\nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('0004', 'giacche', '12', 'giovannibuonasera', '0004', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"pantaloncino inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n\n// Loop per inserire 10 sCamminata\nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('0005', 'camminata', '12', 'giovannibuonasera', '0005', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"sCamminata inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n// Loop per inserire 10 sCorsa\nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('0006', 'corsa', '12', 'giovannibuonasera', '0006', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"sCorsa inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n\n// Loop per inserire 10 sAllenamento\nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('0007', 'allenamento', '12', 'giovannibuonasera', '0007', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"sAllenamento inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n\n// Loop per inserire 10 borsa\nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('0008', 'borsa', '12', 'giovannibuonasera', '0008', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"borsa inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n\n// Loop per inserire 10 cappelli\nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('0009', 'cappelli', '12', 'giovannibuonasera', '0009', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"borsa inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n\n\n// Loop per inserire 10 occhiali\nfor ($i = 0; $i < 10; $i++) {\n    $sql = \"INSERT INTO t_prodotto (id_categoria, nome, prezzo, descrizione, id_prodotto, colore, taglia) VALUES ('0010', 'occhiali', '12', 'giovannibuonasera', '0010', 'blu', 'm')\";\n    if (mysqli_query($conn, $sql)) {\n        echo \"occhiali inserito correttamente\";\n    } else {\n        echo \"Error: \" . $sql . \"<br>\" . mysqli_error($conn);\n    }\n}\n\n//mysqli_close($conn);\n\n\n//funzione per selezionare le magliette \nfunction selezionaMagliette($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'maglietta'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $magliette = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $magliette[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $magliette;\n}\n\n\n//funzione per selezionare i pantaloni\nfunction selezionaPantaloni($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'pantaloni'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $pantaloni = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $felpe[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $pantaloni;\n}\n \n//funzione per selezionare le felpe\nfunction selezionaFelpe($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'felpe'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $felpe = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $felpe[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $felpe;\n}\n\n\n//funzione per selezionare per gonne e vestiti\nfunction selezionaGonne($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'gonne e vestiti'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $gonne = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $gonne[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $gonne;\n}\n\n\n//funzione per selezionare per i pantaloncini\nfunction selezionaPantaloncini($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'pantaloncini'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $pantaloncini = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $pantaloncini[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $pantaloncini;\n}\n\n\n//funzione per selezionare le giacche\nfunction selezionaGiacche($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'giacche'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $giacche = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $giacche[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $giacche;\n}\n\n\n\n//funzione per selezionare le sCamminata\nfunction selezionaCamminata($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'camminata'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $camminata = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $camminata[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $camminata;\n}\n\n\n//funzione per selezionare le sCorsa\nfunction selezionaCorsa($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'corsa'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $corsa = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $corsa[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $corsa;\n}\n\n\n//funzione per selezionare le sAllenamento\nfunction selezionaAllenamento($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'allenamento'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $allenamento = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $allenamento[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $allenamento;\n}\n\n\n//funzione per selezionare le borse\nfunction selezionaBorse($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'borse'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $borse = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $borse[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $borse;\n}\n\n\n//funzione per selezionare le cappelli\nfunction selezionaCappelli($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'cappelli'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $cappelli = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $cappelli[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $cappelli;\n}\n\n\n//funzione per selezionare le Occhiali\nfunction selezionaOcchiali($conn) {\n    $sql = \"SELECT * FROM t_prodotto WHERE nome = 'occhiali'\";\n    $result = mysqli_query($conn, $sql);\n    \n    $occhiali = array();\n    \n    if (mysqli_num_rows($result) > 0) {\n      while($row = mysqli_fetch_assoc($result)) {\n        $occhiali[] = array(\n          'id_prodotto' => $row['id_prodotto'],\n          'nome' => $row['nome'],\n          'prezzo' => $row['prezzo'],\n          'descrizione' => $row['descrizione'],\n          'colore' => $row['colore'],\n          'taglia' => $row['taglia']\n        );\n      }\n    }\n    \n    return $occhiali;\n}\n\n\n\n\n\n?>\n\n"
  core.php: "<?php\nheader('Access-Control-Allow-Origin: http://localhost:3000');\n\nfunction connectDatabase() {\n\t$servername = \"db\";\n\t$username = \"root\";\n\t$password = \"\";\n\t$dbname = \"progetto_scuola\";\n\n\t// Create connection\n\t$conn = new mysqli($servername, $username, $password, $dbname);\n\n\t// Check connection\n\tif ($conn->connect_error) {\n\t\terror_log(\"Connection failed: \" . $conn->connect_error); // Log error to a file\n\t\tdie(json_encode(['error' => 'Database connection failed'])); // Return a JSON response\n\t}\n\techo \"Database Connected.\\n\";\n\n    return $conn;\n}\n\nfunction makePreparedStatement($conn, $query, $var1, $var2=null, $var3=null) {\n    if ($var2 == null) {\n        $stmt = $conn->prepare(\"$query\");\n        $stmt->bind_param(\"s\", $var1);\n\n        $stmt->execute();\n        \n        return $stmt->get_result();\n    }\n\telse if ($var3 == null) {\n        $stmt = $conn->prepare(\"$query\");\n\t\t$stmt->bind_param(\"ss\", $var1, $var2);\n        \n\t\t$stmt->execute();\n\n        return $stmt->get_result();\n    } else {\n        $stmt = $conn->prepare(\"$query\");\n\t\t$stmt->bind_param(\"sss\", $var1, $var2, $var3);\n        \n\t\t$stmt->execute();\n\n        return $stmt->get_result();\n    }\n}"
  index.php: "<?php\n\ninclude_once 'C:\\Users\\PC-A59\\Documents\\GitHub\\ecommerce-project\\src\\Database\\Funzioni\\Connection.php';\n//Connessione\nmysqli_select_db($conn, $database);\n\n$sql = \"CREATE DATABASE Progetto_Scuola\";\nif ($conn->query($sql) === TRUE) {\n    echo \"Database creato con successo :) \";\n} else {\n    echo \"Database non creato :'( \" . $conn->error;\n}\n\n//Creazione tabella utente\n$sql = \"CREATE TABLE t_utente (\n    email varchar(255) NOT NULL UNIQUE,\n    nome varchar(255) NOT NULL,\n    pass varchar(255) NOT NULL,\n    data_nascita date NOT NULL,\n    telefono varchar(10) DEFAULT NULL,\n    consenso_trattamento tinyint(4) NOT NULL,\n    cognome varchar(255) NOT NULL,\n    PRIMARY KEY (email)\n);\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella utente creata con successo\";\n} else {\n    echo \"Errore creazione tabella utente: \" . $conn->error;\n}\n\n//Creazione tabella carta\n$sql = \"CREATE TABLE t_carta_di_pagamento (\n    email varchar(255) NOT NULL,\n    numero int(12) NOT NULL,\n    scadenza date NOT NULL,\n    nome varchar(255) NOT NULL,\n    cognome varchar(255) NOT NULL,\n    debito tinyint(4) NOT NULL,\n    credito tinyint(4) NOT NULL,\n    prepagata tinyint(4) NOT NULL,\n    PRIMARY KEY (numero),\n    FOREIGN KEY (email) REFERENCES t_utente(email)\n);\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella carta creata con successo\";\n} else {\n    echo \"Errore creazione tabella carta: \" . $conn->error;\n}\n\n//Creazione tabella categoria\n$sql = \"CREATE TABLE t_categoria (\n    id_categoria int(4) NOT NULL,\n    tipo_categoria varchar(255) NOT NULL,\n    PRIMARY KEY (id_categoria)\n  );\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella categoria creata con successo\";\n} else {\n    echo \"Errore creazione tabella categoria: \" . $conn->error;\n}\n\n//Creazione tabella prodotto\n$sql = \"CREATE TABLE t_prodotto (\n    id_categoria int(4) NOT NULL,\n    nome varchar(255) NOT NULL,\n    prezzo float NOT NULL,\n    descrizione varchar(255) NOT NULL,\n    id_prodotto int(4) NOT NULL,\n    PRIMARY KEY (id_prodotto),\n    FOREIGN KEY (id_categoria) REFERENCES t_categoria(id_categoria)\n  );\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella prodotto creata con successo\";\n} else {\n    echo \"Errore creazione tabella prodotto: \" . $conn->error;\n}\n\n//Creazione tabella acquista\n$sql = \"CREATE TABLE t_acquisto (\n    email varchar(255) NOT NULL,\n    id_prodotto int(4) NOT NULL,\n    id_acquisto int(5) NOT NULL,\n    qualitÃ  varchar(255) NOT NULL,\n    data_acquisto date NOT NULL,\n    via varchar(255) NOT NULL,\n    citta varchar(255) NOT NULL,\n    PRIMARY KEY (id_acquisto),\n    FOREIGN KEY (email) REFERENCES t_utente(email),\n    FOREIGN KEY (id_prodotto) REFERENCES t_prodotto(id_prodotto)\n  );\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella acquista creata con successo\";\n} else {\n    echo \"Errore creazione tabella acquista: \" . $conn->error;\n}\n\n//Creazione tabella dipendente\n$sql = \"CREATE TABLE t_dipendente (\n    id_dipendente int(5) NOT NULL AUTO_INCREMENT,\n    nome varchar(255) NOT NULL,\n    cognome varchar(255) NOT NULL,\n    data_nascita date NOT NULL,\n    PRIMARY KEY (id_dipendente)\n  );\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella dipendente creata con successo\";\n} else {\n    echo \"Errore creazione tabella dipendente: \" . $conn->error;\n}\n\n//Creazione tabella dipendente_prodotto\n$sql = \"CREATE TABLE t_dipendete_prodotto (\n    id_dipendente int(5) NOT NULL,\n    id_prodotto int(4) NOT NULL,\n    id_dip_prod int(5) NOT NULL AUTO_INCREMENT,\n    PRIMARY KEY (id_dip_prod),\n    FOREIGN KEY (id_dipendente) REFERENCES t_dipendente(id_dipendente),\n    FOREIGN KEY (id_prodotto) REFERENCES t_prodotto(id_prodotto)\n  );\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella dipendente_prodotto creata con successo\";\n} else {\n    echo \"Errore creazione tabella dipendente_prodotto: \" . $conn->error;\n}\n\n//Creazione tabella ticket reso\n$sql = \"CREATE TABLE t_ticket_reso (\n    id_ticket int(5) NOT NULL AUTO_INCREMENT,\n    id_acquisto int(5) NOT NULL,\n    id_dip_prod int(5) NOT NULL,\n    motivazione varchar(255) NOT NULL,\n    PRIMARY KEY (id_ticket),\n    FOREIGN KEY (id_acquisto) REFERENCES t_acquisto(id_acquisto),\n    FOREIGN KEY (id_dip_prod) REFERENCES t_dipendete_prodotto(id_dip_prod)\n  );\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella ticket reso creata con successo\";\n} else {\n    echo \"Errore creazione tabella ticket reso: \" . $conn->error;\n}\n//Creazione tabella prodotto categoria\n$sql = \"CREATE TABLE t_prod_cat (\n    id_prod_cat int(5) NOT NULL UNIQUE AUTO_INCREMENT,\n    id_prodotto int(4) NOT NULL,\n    id_categoria int(4) NOT NULL,\n    PRIMARY KEY (id_prod_cat),\n    FOREIGN KEY (id_prodotto) REFERENCES t_prodotto (id_prodotto),\n    FOREIGN KEY (id_categoria) REFERENCES t_categoria (id_categoria)\n);\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella prodotto categoria creata con successo\";\n} else {\n    echo \"Errore creazione tabella prodotto categoria: \" . $conn->error;\n}\n\n//Creazione tabella taglia \n$sql = \"CREATE TABLE t_taglia(\n    id_taglia int(4) NOT NULL UNIQUE AUTO_INCREMENT,\n    id_prodotto int(4) NOT NULL,\n    taglia varchar(255) NOT NULL,\n    prezzo_offerta float NOT NULL,\n    PRIMARY KEY (id_taglia),\n    FOREIGN KEY (id_prodotto) REFERENCES t_prodotto (id_prodotto)\n);\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella taglia creata con successo\";\n} else {\n    echo \"Errore creazione tabella taglia: \" . $conn->error;\n}\n\n\n//Creazione tabella colore  \n$sql = \"CREATE TABLE t_colore(\n    id_colore int(4) NOT NULL UNIQUE AUTO_INCREMENT,\n    id_prodotto int(4) NOT NULL,\n    colore varchar(255) NOT NULL,\n    prezzo_offerta float NOT NULL,\n    PRIMARY KEY (id_colore),\n    FOREIGN KEY (id_prodotto) REFERENCES t_prodotto (id_prodotto)\n);\";\n\nif ($conn->query($sql) === TRUE) {\n    echo \"Tabella colore creata con successo\";\n} else {\n    echo \"Errore creazione tabella colore: \" . $conn->error;\n}\n\n$conn->close();\n\n?>"
  login.php: "<?php\n\theader('Access-Control-Allow-Origin: http://localhost:3000');\n\n\tinclude \"core.php\";\n\n\t// Connecting to Database\n\t$conn = connectDatabase();\n\n\t// Gets the input from the login form\n\t$login_email = filter_input(INPUT_POST, 'email', FILTER_SANITIZE_EMAIL);\n\t$login_password = filter_input(INPUT_POST, 'pass', FILTER_SANITIZE_FULL_SPECIAL_CHARS);\n\n\t// Makes a prepared statement\n\t$chck_stmt = makePreparedStatement($conn, \"SELECT * FROM t_utente WHERE email = ?\", $login_email);\n\n\tif ($chck_stmt->num_rows == 0) {\n\t\t$chck_stmt->close();\n\t\techo json_encode(['error' => \"Email o Password Sbagliata\"]);\n\t} else {\n\t\t// User exists, check the password\n\t\t$row = $chck_stmt->fetch_assoc();\n\t\t$dbpass = $row['pass'];\n\t\t$chck_stmt->close();\n\t\t\n\t\t// Verify the password\n\t\tif (password_verify($login_password, $dbpass)) {\n\t\t\t$_SESSION['login_user'] = $row['nome']; // Set session variable after successful login\n\t\t\techo json_encode(['success' => \"Connected to: \" . $row['nome']]);\n\t\t} else {\n\t\t\techo json_encode(['error' => \"Email o Password Sbagliata\"]);\n\t\t}\n\t}\n\t\n\t/*if ($chck_stmt->num_rows == 0) {\n\t\t// User does not exist, proceed with registration\n\t\t$chck_stmt -> close();\n\t\t$hashedPass = password_hash($login_password, PASSWORD_DEFAULT); \n\n\t\t$stmt = makePreparedStatement($conn, \"INSERT INTO t_utente_2 (username, email, password) \n\t\t\t\t\t\t\t\t\t\t\t\tVALUES ('mario', ?, ?)\", $login_email, $hashedPass);\n\n\t\t//$stmt->close();\n\t\t\n\t\techo json_encode(['success' => \"Registrato Correttamente\"]);\n\t} else {\n\t\t$chck_stmt->close();\n\t\techo json_encode(['error' => \"L'utente esiste gia!\"]);\n\t}*/\n\n\t$conn->close();"
  register.php: "<?php\nheader('Access-Control-Allow-Origin: http://localhost:8000/progetto_scuola');\nheader('Access-Control-Allow-Methods: POST');\nheader('Access-Control-Allow-Headers: Content-Type');\n\t\n\tinclude \"core.php\";\n\n\t// Connecting to Database\n\t$conn = connectDatabase();\n\n\t// Gets the input from the login form\n\t$login_nome = filter_input(INPUT_POST, 'nome', FILTER_SANITIZE_FULL_SPECIAL_CHARS);\n\t$login_cognome = filter_input(INPUT_POST, 'cognome', FILTER_SANITIZE_FULL_SPECIAL_CHARS);\n\t$login_email = filter_input(INPUT_POST, 'email', FILTER_SANITIZE_EMAIL);\n\t$login_password = filter_input(INPUT_POST, 'pass_r', FILTER_SANITIZE_FULL_SPECIAL_CHARS);\n\t$login_nascita = filter_input(INPUT_POST, 'data_nascita', FILTER_SANITIZE_FULL_SPECIAL_CHARS);\n\t$login_telefono = filter_input(INPUT_POST, 'telefono', FILTER_SANITIZE_FULL_SPECIAL_CHARS);\n\t$login_trattamento = filter_input(INPUT_POST, 'trattamento', FILTER_SANITIZE_FULL_SPECIAL_CHARS);\n\n\t// Makes a prepared statement\n\t$chck_stmt = makePreparedStatement($conn, \"SELECT * FROM t_utente WHERE email = ?\", $login_email);\n\t\n\tif ($chck_stmt->num_rows == 0) {\n\t\t// User does not exist, proceed with registration\n\t\t$chck_stmt -> close();\n\t\t$hashedPass = password_hash($login_password, PASSWORD_DEFAULT);\n\n\t\t$query = \"INSERT INTO t_utente (nome, cognome, email, pass, data_nascita, telefono, consenso_trattamento) VALUES (?, ?, ?, ?, ?, ?, ?)\";\n\t\t$stmt = $conn->prepare(\"$query\");\n        $stmt->bind_param(\"sssssss\", $login_nome, $login_cognome, $login_email, $hashedPass, $login_nascita, $login_telefono, $login_trattamento);\n\n        $stmt->execute();\n        \n        $result = $stmt->get_result();\n\n\t\t//$stmt->close();\n\t\t\n\t\techo json_encode(['success' => \"Registrato Correttamente\"]);\n\t} else {\n\t\t$chck_stmt->close();\n\t\techo json_encode(['error' => \"L'utente esiste gia!\"]);\n\t}\n\n\t$conn->close();"
kind: ConfigMap
metadata:
  labels:
    io.kompose.service: php
  name: php-cm0
